<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0c204a">
<title>Operation Sky Core — Phase 1 (v2.1)</title>
<style>
:root{--bg:#0c204a;--panel:#163678;--text:#e7eef9;--muted:#a0b8d6;--border:#263a64;--accent:#2d6edc}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:16px}header{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
h1{font-size:18px;margin:0}.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
input,select,button,textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 12px;font-size:14px}
button{cursor:pointer}.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px;margin:12px 0}
.grid{display:grid;grid-template-columns:1fr 60px 70px 1fr;gap:8px;align-items:center}.gridHeader{color:var(--muted);font-weight:700;font-size:12px}
.note{width:100%;min-height:70px}.chip{border:1px solid var(--border);background:var(--panel);color:var(--muted);border-radius:999px;padding:6px 10px;font-size:12px}
.muted{color:var(--muted)}.lynx{display:inline-flex;align-items:center;gap:6px}.lynx:before{content:"🐾"}
.badges{display:flex;gap:6px}.badge{border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted)}
.progress{height:10px;background:#0b1a3a;border-radius:999px;border:1px solid var(--border);overflow:hidden}
.progress>div{height:100%;background:var(--accent);width:0%}
.exercise-link{text-decoration:underline;cursor:pointer}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
.modal .box{background:#0e1f4a;border:1px solid var(--border);max-width:720px;width:100%;border-radius:14px;overflow:hidden}
.modal header{padding:12px 16px;border-bottom:1px solid var(--border)}.modal .content{padding:16px}
.modal h3{margin:0;font-size:18px}.modal ul{margin:.25rem 0 .75rem 1.25rem}.modal .close{margin-left:auto}
.small{font-size:12px;color:var(--muted)}
.toggle{margin-left:6px}
.hidden{display:none}

.danger{background:#b3261e !important;color:#fff !important;border-color:#7f1d18 !important}
#resetAppBtn{display:none}
body.coach #resetAppBtn{display:inline-block}
body:not(.coach) #player, body:not(.coach) #addPlayer { display:none !important; }

  .fab{z-index:2147483647; position:fixed;right:14px;bottom:14px;background:#2d6edc;color:#fff;border:none;border-radius:999px;padding:12px 16px;font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,.3);z-index:1000}

/* Hide coach controls for players */
body:not(.coach) #settingsBtn,
body:not(.coach) #coachModeBtn,
body:not(.coach) .toggle,
body:not(.coach) #fabSettings { display:none !important; }

  
/* Player-only build: hide coach UI visually */
#coachPanel, #coachMgmt, #coachFab, label[for="coachToggle"], #coachToggle, #sendCoach { display:none !important; }
</style></head>
<body>
<div class="wrap">
<header class="row">
  <h1>Operation Sky Core — <span id="phaseLabel">Phase 1</span> <span class="small" id="verLabel">(Player v3.1.0)</span></h1>
  <div class="row">
    <select id="player"></select><button id="addPlayer">+ Player</button>
    <select id="daySel"><option value="1">Day 1</option><option value="2">Day 2</option><option value="3">Day 3</option></select>
    <select id="week"></select>
    <button id="exportCsv">Export</button>
    <button id="sendCoach">Send to Coach</button>
    <button id="settingsBtn" onclick="openSettings()">Settings</button>
      <button id="coachModeBtn">Coach Mode</button>
    <label class="toggle"><input type="checkbox" id="coachToggle"> Coach View</label>
  </div>
</header>
<div class="row" id="hdr">
  <span class="chip lynx" id="schoolTag">CORE Butte High Lynx | Blue & White</span>
  <span class="chip" id="xp">XP 0</span><span class="chip" id="streak">Streak 0</span>
  <div class="badges" id="badges" title="Bronze=100 XP, Silver=300 XP, Gold=600 XP"></div>
</div>
<div class="card"><strong>Progress</strong><div class="progress"><div id="xpbar"></div></div><div class="small">Badges: Bronze 100 | Silver 300 | Gold 600</div></div>
<div id="coachPanel" class="card hidden"><strong>Coach View</strong><div id="coachList" class="small">All players summary appears here.</div></div>
<div class="card"><strong>Why today matters</strong><div id="why"></div></div>
<div id="content"></div>
<div class="card"><strong>Notes</strong><textarea id="notes" class="note" placeholder="Notes for today..."></textarea></div>
</div>
<div class="wrap card hidden" id="settings">
  <strong>Settings</strong>
  <div class="row" style="margin-top:8px">
    <input id="sPlayerName" placeholder="Player name">
    <input id="sSchool" placeholder="School" value="CORE Butte High">
    <input id="sMascot" placeholder="Mascot" value="Lynx">
    <input id="sColors" placeholder="Colors" value="Blue & White">
    <input id="sCoachUrl" placeholder="Coach Sync URL (optional)">
    <button id="saveSettings">Save</button>
    <button id="resetAppBtn" class="danger">Reset App</button>
  </div>
</div>
<div class="modal" id="trainerModal">
  <div class="box">
    <header class="row"><h3 id="mTitle">Exercise</h3><button class="close" id="mClose">Close</button></header>
    <div class="content">
      <div class="muted">Setup</div><ul id="mSetup"></ul>
      <div class="muted">Execution</div><ul id="mExec"></ul>
      <div class="muted">Focus cues</div><ul id="mFocus"></ul>
      <div class="muted">Common mistakes</div><ul id="mMistakes"></ul>
      <div class="muted">Why this increases vertical</div><ul id="mWhy"></ul>
    </div>
  </div>
</div>
<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(()=>{});}

const PROGRAM={1:{label:"Day 1 — Lower Body + Jump",why:["Heavy basics raise leg drive and stable landings.","Strong positions protect knees and back."],warmup:["Leg Swings — 10 each","Walking Lunges — 10 each","Bodyweight Squat — 3×10","Standing Calf Raise — 3×10","Light Jumps — 3×5"],strength:[{ex:"Back or Goblet Squat",sets:4,reps:"6–8",weighted:true},{ex:"Romanian Deadlift",sets:3,reps:"8–10",weighted:true},{ex:"Walking Lunges",sets:3,reps:"10 each",weighted:true},{ex:"Bulgarian Split Squat",sets:3,reps:"8 each",weighted:true},{ex:"Standing Calf Raise (Loaded)",sets:4,reps:"12–15",weighted:true}],core:["Hanging Knee Raise — 3×10","Plank — 3×30–45s"],jump:["Two-step approach jumps — 5","Touch rim/backboard — 3×5","Form jumps — 3×10"]},2:{label:"Day 2 — Upper Body + Core",why:["Stronger torso keeps power from leaking.","Arm swing speed adds inches to reach."],warmup:["Arm Circles — 15/15","Band Pull-Apart — 15","Push-up to Down Dog — 8","Shoulder Taps — 10/side","Jumping Jacks — 30s"],strength:[{ex:"Barbell or DB Bench Press",sets:4,reps:"6–8",weighted:true},{ex:"Pull-Ups / Assisted Pull-Ups",sets:3,reps:"6–10",weighted:false},{ex:"Standing Overhead Press",sets:3,reps:"8",weighted:true},{ex:"1-Arm Dumbbell Row",sets:3,reps:"10 each",weighted:true},{ex:"Triceps Dips or Pushdowns",sets:3,reps:"12–15",weighted:false}],core:["Hanging Leg Raise — 3×10","Side Plank — 3×30s each","Stability Ball Roll-outs — 3×12","Bird Dog — 3×10 each"],jump:["MB Chest Pass — 3×10","Overhead MB Slam — 3×10","Clap or Plyo Push-ups — 3×6","Sprint 20 yds × 6"]},3:{label:"Day 3 — Plyos + Practice",why:["Fast contacts train spring.","Approach jumps wire skill to power."],warmup:["Dynamic Skips — 2×20 yds","A-Skips & High Knees — 20 yds each","Light Bounding — 2×10","Submax Jumps — 3 at 50–70%"],strength:[{ex:"Box Jump",sets:4,reps:"5",weighted:false},{ex:"Broad Jump",sets:4,reps:"5",weighted:false},{ex:"Lateral Bounds",sets:3,reps:"6 each",weighted:false},{ex:"Depth Drop → Vertical",sets:3,reps:"5",weighted:false},{ex:"Jump Squat (Bodyweight)",sets:3,reps:"8",weighted:false}],core:["Trap/Barbell Deadlift — 4×5","Hip Thrust or Glute Bridge — 3×10"],jump:["Two-step approach jumps — 8","Touch rim/backboard — 3×5","Dunk attempts — 5–10"]}};


// 36 unique 'Why Today Matters' messages (Week 1..12 x Day 1..3)
const WHY = {
  1: {
    1: "Week 1 • Day 1: Lay the foundation. Clean patterns now make every pound you add later translate to inches.",
    2: "Week 1 • Day 2: Strong shoulders and lats protect your landings and add speed to the arm swing.",
    3: "Week 1 • Day 3: Light contacts teach your body to be springy without getting beat up."
  },
  2: {
    1: "Week 2 • Day 1: Small load bumps with the same perfect depth and quiet landings. Consistency wins.",
    2: "Week 2 • Day 2: Press and pull balance builds a stable chest and scapula for powerful takeoff posture.",
    3: "Week 2 • Day 3: Quicker ground contact. Your goal is pop, not height, on every rep."
  },
  3: {
    1: "Week 3 • Day 1: Heavier squats and lunges wire force into stable knees and hips.",
    2: "Week 3 • Day 2: Own tempo. Smooth bar path, no grindy reps—speed beats ego here.",
    3: "Week 3 • Day 3: Bounding carries over to approach steps. Cover ground, stick the landing."
  },
  4: {
    1: "Week 4 • Day 1: Single‑leg strength today pays off on your plant foot next month.",
    2: "Week 4 • Day 2: Overhead work ties the rib cage to the pelvis. That’s how power transfers clean.",
    3: "Week 4 • Day 3: Depth drops sharpen the stretch‑shortening cycle. Short contact, tall finish."
  },
  5: {
    1: "Week 5 • Day 1: Push intensity, not slop. Braced cores and even knees protect progress.",
    2: "Week 5 • Day 2: Rows and pull‑ups keep shoulders honest so pressing keeps moving up.",
    3: "Week 5 • Day 3: Approach jumps—same steps every time. Rhythm makes power repeatable."
  },
  6: {
    1: "Week 6 • Day 1: Earn your last foundation week. Quality reps set up next week’s speed phase.",
    2: "Week 6 • Day 2: Finish Phase 1 strong—posture and bar speed are your priorities.",
    3: "Week 6 • Day 3: Lock in landings. Quiet feet now, louder rim later."
  },
  7: {
    1: "Week 7 • Day 1: Phase 2 begins. Heavier fronts and crisp hinges drive vertical force.",
    2: "Week 7 • Day 2: Lower reps, faster bar. Explosive intent on every set.",
    3: "Week 7 • Day 3: Depth→vertical blends stiffness with pop—jump like a spring, not a pogo stick."
  },
  8: {
    1: "Week 8 • Day 1: Heels‑elevated squats groove quad drive for a higher takeoff position.",
    2: "Week 8 • Day 2: Dips and rows reinforce lockout and mid‑back—finish your reach tall.",
    3: "Week 8 • Day 3: Box height stays safe; win with speed and perfect landings."
  },
  9: {
    1: "Week 9 • Day 1: Split‑squat power today shores up any side‑to‑side weakness in your plant.",
    2: "Week 9 • Day 2: Keep elbows under the bar and ribs down—power flows through a stacked trunk.",
    3: "Week 9 • Day 3: Broad jumps tune horizontal force for your first steps of the approach."
  },
 10: {
    1: "Week 10 • Day 1: Strength peaks only matter if mechanics hold. Brace first, then drive.",
    2: "Week 10 • Day 2: Few reps, fast reps—stop a set when speed drops.",
    3: "Week 10 • Day 3: Lateral bounds reinforce knee control so your plant is confident."
  },
 11: {
    1: "Week 11 • Day 1: Keep jumps sub‑max between heavy sets—save the best for testing soon.",
    2: "Week 11 • Day 2: Press with intent, pull with control—shoulders love the balance.",
    3: "Week 11 • Day 3: String together your best approaches. Rhythm + timing = inches."
  },
 12: {
    1: "Week 12 • Day 1: Final heavy exposures—leave 1–2 reps in the tank and move fast.",
    2: "Week 12 • Day 2: Crisp upper power primes arm speed for test day.",
    3: "Week 12 • Day 3: Peak week. Jump fresh, land soft, and measure your new ceiling."
  }
};

const EX = {"Leg Swings": {"setup": ["Hold wall or rack for balance", "Stand tall; brace lightly"], "exec": ["Swing forward/back gently 10\u201315 reps", "Switch to side-to-side 10\u201315 reps"], "focus": ["Smooth rhythm", "Do not force range"], "mistakes": ["Wild swings", "Torso twisting"], "why": ["Lubricates hips and prepares for jumping"]}, "Bodyweight Squat": {"setup": ["Feet shoulder width; toes slightly out"], "exec": ["Sit between heels; chest proud; stand tall"], "focus": ["Knees track over toes", "Heels stay down"], "mistakes": ["Knees cave", "Rounding back"], "why": ["Grooves squat pattern for safe loading"]}, "Standing Calf Raise": {"setup": ["Feet shoulder width; neutral pelvis"], "exec": ["Rise tall, pause 1s; lower 2\u20133s to stretch"], "focus": ["Full range", "Even pressure across forefoot"], "mistakes": ["Half reps", "Ankles rolling"], "why": ["Improves ankle stiffness and elastic recoil"]}, "Light Jumps": {"setup": ["Athletic stance"], "exec": ["Quick dip; jump lightly; land soft; reset"], "focus": ["Quiet feet", "Small height; focus on mechanics"], "mistakes": ["Stomping", "Letting knees collapse"], "why": ["Primes nervous system without fatigue"]}, "Walking Lunges": {"setup": ["Stand tall; optional light DBs at sides"], "exec": ["Step forward; lower till back knee hovers", "Push through front heel to stand"], "focus": ["Even steps; tall torso", "Knee over mid-foot"], "mistakes": ["Short steps", "Torso collapse"], "why": ["Single-leg strength and balance for stable plants"]}, "Back or Goblet Squat": {"setup": ["Feet shoulder width; brace core", "Goblet: DB at chest. Back: bar across traps"], "exec": ["Lower 2\u20133s; explode up; heels down"], "focus": ["Depth you control", "Brace hard"], "mistakes": ["Heels up", "Knees cave"], "why": ["Raises leg force output for takeoff"]}, "Romanian Deadlift": {"setup": ["Feet hip width; soft knees; lats tight"], "exec": ["Hips back; bar close; stand by squeezing glutes"], "focus": ["Neutral spine", "Bar path close"], "mistakes": ["Locked knees", "Bar drifting forward"], "why": ["Glute/hamstring drive adds inches to vertical"]}, "Bulgarian Split Squat": {"setup": ["Rear foot on bench; front foot forward"], "exec": ["Lower straight down; slight forward torso", "Drive through front heel"], "focus": ["Front leg works", "Knee over toes"], "mistakes": ["Pushing off back leg"], "why": ["Boosts unilateral force in jump positions"]}, "Standing Calf Raise (Loaded)": {"setup": ["Smith/machine or DBs"], "exec": ["Full rise with 1s pause; slow 2\u20133s lower"], "focus": ["Do not bounce", "Stay tall"], "mistakes": ["Half reps", "Leaning"], "why": ["Greater plantarflexor strength for takeoff"]}, "Hanging Knee Raise": {"setup": ["Hang; ribs down"], "exec": ["Lift knees to hip height; no swing"], "focus": ["Control", "Exhale during lift"], "mistakes": ["Swinging"], "why": ["Trunk control for power transfer"]}, "Plank": {"setup": ["Elbows under shoulders; straight line"], "exec": ["Brace glutes/abs; breathe behind brace"], "focus": ["Neutral spine"], "mistakes": ["Sagging hips"], "why": ["Rigid torso to transmit leg power"]}, "Two-step approach jumps": {"setup": ["Short two-step run-up"], "exec": ["Quick plant; load; full arm swing; explode"], "focus": ["Timing plant", "Fast transition"], "mistakes": ["Choppy steps"], "why": ["Real-game rhythm and elastic timing"]}, "Form jumps": {"setup": ["Stand still; feet under shoulders"], "exec": ["Jump straight up; land soft; reset"], "focus": ["Quiet feet", "Knees track over toes"], "mistakes": ["Stomping"], "why": ["Perfect jump pattern and landing control"]}, "Touch rim/backboard": {"setup": ["Use same approach each rep"], "exec": ["Reach tall at peak; stick the landing"], "focus": ["Consistency", "Full extension"], "mistakes": ["Changing rhythm"], "why": ["Measurable target; peak reach timing"]}, "Barbell or DB Bench Press": {"setup": ["Feet planted; shoulders back"], "exec": ["Lower to mid-chest; elbows ~45\u00b0", "Press bar over shoulders"], "focus": ["Stable base", "Explosive press"], "mistakes": ["Flaring elbows"], "why": ["Faster arm swing and stronger finish"]}, "Pull-Ups / Assisted Pull-Ups": {"setup": ["Start from full hang; core tight"], "exec": ["Pull chest toward bar; elbows down"], "focus": ["Full range", "No swing"], "mistakes": ["Half reps"], "why": ["Lat strength stabilizes shoulder"]}, "Standing Overhead Press": {"setup": ["Feet hip width; bar at collarbone"], "exec": ["Press overhead; head through window"], "focus": ["Straight bar path", "Ribs down"], "mistakes": ["Overarching back"], "why": ["Links leg drive to reach through a rigid trunk"]}, "1-Arm Dumbbell Row": {"setup": ["Hand/knee on bench or hip hinge"], "exec": ["Pull DB toward hip; pause top"], "focus": ["Shoulder down/back"], "mistakes": ["Yanking weight"], "why": ["Anti-rotation for stable plants/landings"]}, "Triceps Dips or Pushdowns": {"setup": ["Parallel bars or cable"], "exec": ["Elbows close; lower controlled"], "focus": ["Squeeze lockout"], "mistakes": ["Flaring elbows"], "why": ["Stronger finish at the rim"]}, "Side Plank": {"setup": ["Elbow under shoulder; legs stacked"], "exec": ["Lift hips; hold straight line"], "focus": ["Hips high"], "mistakes": ["Hips dropping"], "why": ["Resists side-bend forces on approach"]}, "Stability Ball Roll-outs": {"setup": ["Kneel; forearms on ball"], "exec": ["Roll forward keeping ribs down"], "focus": ["No low-back arch"], "mistakes": ["Overreaching"], "why": ["Anterior core strength for hip drive"]}, "Bird Dog": {"setup": ["Hands under shoulders; knees under hips"], "exec": ["Reach opposite arm/leg; brief hold"], "focus": ["Hips level"], "mistakes": ["Twisting"], "why": ["Cross-body stability used in approach steps"]}, "MB Chest Pass": {"setup": ["Ball at chest; athletic stance"], "exec": ["Explode; release straight ahead"], "focus": ["Fast push; follow-through"], "mistakes": ["Slow throw"], "why": ["Upper power; speeds arm swing"]}, "Overhead MB Slam": {"setup": ["Ball overhead; ribs down"], "exec": ["Slam ball; use lats and core"], "focus": ["Full reach then snap"], "mistakes": ["Overarching"], "why": ["Triple flexion and trunk snap"]}, "Clap or Plyo Push-ups": {"setup": ["Push-up position; core tight"], "exec": ["Explosive push; hands leave floor"], "focus": ["Speed and control"], "mistakes": ["Sagging hips"], "why": ["Upper-body RFD to match leg power"]}, "Sprint 20 yds": {"setup": ["Clear straight line"], "exec": ["Accelerate hard; quick turnover"], "focus": ["Powerful first steps"], "mistakes": ["Overstriding"], "why": ["Raises neural drive for approaches"]}, "Box Jump": {"setup": ["Safe height; step away"], "exec": ["Load hips; swing arms; jump; land soft"], "focus": ["Quiet landings"], "mistakes": ["Too high box"], "why": ["Rapid force production"]}, "Broad Jump": {"setup": ["Flat space"], "exec": ["Load; jump forward; stick landing"], "focus": ["Distance with control"], "mistakes": ["Falling forward"], "why": ["Horizontal force and hip drive"]}, "Lateral Bounds": {"setup": ["Stand on one leg"], "exec": ["Explode sideways; land on other leg"], "focus": ["Knee alignment"], "mistakes": ["Wobbly knee"], "why": ["Side-to-side force and single-leg control"]}, "Depth Drop \u2192 Vertical": {"setup": ["Low box 12\u201318 in"], "exec": ["Step off; absorb; short contact; jump up"], "focus": ["Soft land; minimal ground time"], "mistakes": ["Too high box"], "why": ["Sharpens stretch\u2013shortening cycle"]}, "Jump Squat (Bodyweight)": {"setup": ["Athletic stance"], "exec": ["Quick dip; explode; land soft; reset"], "focus": ["Vertical force"], "mistakes": ["Too deep"], "why": ["Speed of force application"]}, "Trap/Barbell Deadlift": {"setup": ["Feet hip width; bar over midfoot"], "exec": ["Brace; push floor away; stand tall"], "focus": ["Neutral spine; bar close"], "mistakes": ["Rounding back"], "why": ["Total-body force; hip/knee drive"]}, "Hip Thrust or Glute Bridge": {"setup": ["Shoulders on bench/floor; load at hips"], "exec": ["Drive through heels; squeeze top"], "focus": ["Posterior tilt; glute squeeze"], "mistakes": ["Short range"], "why": ["Direct hip extension power"]}, "Dunk attempts": {"setup": ["Use same approach each rep"], "exec": ["Commit to takeoff; decide early"], "focus": ["Confidence; timing"], "mistakes": ["Indecision"], "why": ["Skill on top of power"]}, "Arm Circles":{"setup":["Stand tall; arms out to sides"],"exec":["Small circles forward 15–30s, then backward 15–30s"],"focus":["Shoulders down/back","Smooth rhythm"],"mistakes":["Shrugging","Arching back"],"why":["Warms shoulder joint for pressing and overhead work"]}, "Band Pull-Apart":{"setup":["Hold light band at chest height"],"exec":["Pull band apart by squeezing shoulder blades"],"focus":["Elbows soft","Neck relaxed"],"mistakes":["Shrugging","Overextending ribs"],"why":["Activates mid-back for posture and shoulder health"]}, "Push-up to Down Dog":{"setup":["High plank position"],"exec":["Lower to push-up, then shift hips back to Down Dog"],"focus":["Strong core","Full scapular movement"],"mistakes":["Sagging hips"],"why":["Warms shoulders, core, and posterior chain"]}, "Shoulder Taps":{"setup":["High plank, feet hip-width"],"exec":["Tap opposite shoulder with hand, alternate"],"focus":["Hips stable","Wide base if needed"],"mistakes":["Swaying hips"],"why":["Anti-rotation core and shoulder stability"]}, "Jumping Jacks":{"setup":["Stand tall"],"exec":["Jump feet out while raising arms overhead, then return"],"focus":["Relaxed rhythm","Nasal breathing"],"mistakes":["Locked knees"],"why":["Elevates heart rate and warms whole body"]}, "Dynamic Skips":{"setup":["Open court or lane"],"exec":["Skip with knee drive and opposite arm swing"],"focus":["Tall posture","Rhythmic ground contacts"],"mistakes":["Slouching"],"why":["Coordinates hip drive and arm action"]}, "A-Skips":{"setup":["Mark a straight line"],"exec":["Drive knee up; strike ground under hips; alternate"],"focus":["Dorsiflexed ankle","Quick contacts"],"mistakes":["Overstriding"],"why":["Teaches sprint mechanics for approach steps"]}, "High Knees":{"setup":["Athletic posture"],"exec":["Run in place bringing knees to hip height"],"focus":["Quick feet","Arm swing"],"mistakes":["Leaning back"],"why":["Increases cadence and hip flexor activation"]}, "Bounding":{"setup":["Flat space"],"exec":["Exaggerated stride with powerful push-off"],"focus":["Hang time with control"],"mistakes":["Collapsing knee"],"why":["Builds horizontal power and stiffness"]}, "Light Bounding":{"setup":["Short distance"],"exec":["Easy bounds focusing on foot placement"],"focus":["Quiet landings"],"mistakes":["Heavy contacts"],"why":["Priming without fatigue"]}, "Submax Jumps":{"setup":["Athletic stance"],"exec":["Jumps at 50–70% effort; stick landings"],"focus":["Mechanics over height"],"mistakes":["Hard landings"],"why":["Nervous system prep without fatigue"]}, "Hanging Leg Raise":{"setup":["Hang; ribs down"],"exec":["Raise straight legs to hip height or higher without swing"],"focus":["Control and exhale"],"mistakes":["Swinging","Arching back"],"why":["Anterior core strength for power transfer"]}};

const WEEKS=12;
const listKey="osc_players"; const key=(p,d,w)=>`osc_p${p}_d${d}_w${w}`; const settingsKey=(p)=>`osc_settings_${p}`; const xpKey=(p)=>`osc_xp_${p}`; const streakKey=(p)=>`osc_streak_${p}`; const lastKey=(p)=>`osc_last_${p}`; const earnedKey=(p)=>`osc_earned_${p}`;

function loadPlayers(){ const raw=localStorage.getItem(listKey); return raw?JSON.parse(raw):["Sam"]; }
function savePlayers(v){ localStorage.setItem(listKey, JSON.stringify(v)); }
function loadSettings(p){ return JSON.parse(localStorage.getItem(settingsKey(p))||'{"school":"CORE Butte High","mascot":"Lynx","colors":"Blue & White","coachUrl":""}'); }
function saveSettings(p,s){ localStorage.setItem(settingsKey(p), JSON.stringify(s)); }
function loadEntry(p,d,w){ const raw=localStorage.getItem(key(p,d,w)); return raw?JSON.parse(raw):null; }
function saveEntry(p,d,w,val){ localStorage.setItem(key(p,d,w), JSON.stringify(val)); }
function getXP(p){ return +(localStorage.getItem(xpKey(p))||0); }
function setXP(p,v){ localStorage.setItem(xpKey(p), v); }
function getStreak(p){ return +(localStorage.getItem(streakKey(p))||0); }
function setStreak(p,v){ localStorage.setItem(streakKey(p), v); }
function getLast(p){ return localStorage.getItem(lastKey(p)); }
function setLast(p,day){ localStorage.setItem(lastKey(p), day); }
function loadEarned(p){ return JSON.parse(localStorage.getItem(earnedKey(p))||'{}'); }
function saveEarned(p,m){ localStorage.setItem(earnedKey(p), JSON.stringify(m)); }

const playerSel=document.getElementById('player');const addPlayerBtn=document.getElementById('addPlayer');const daySel=document.getElementById('daySel');const weekSel=document.getElementById('week');
const whyDiv=document.getElementById('why');const content=document.getElementById('content');const notes=document.getElementById('notes');const xpEl=document.getElementById('xp');const streakEl=document.getElementById('streak');
const exportBtn=document.getElementById('exportCsv');const sendCoach=document.getElementById('sendCoach');const settingsBtn=document.getElementById('settingsBtn');const settings=document.getElementById('settings');
const sPlayerName=document.getElementById('sPlayerName');const sSchool=document.getElementById('sSchool');const sMascot=document.getElementById('sMascot');const sColors=document.getElementById('sColors');const sCoachUrl=document.getElementById('sCoachUrl');const saveBtn=document.getElementById('saveSettings');
const xpbar=document.getElementById('xpbar');const badges=document.getElementById('badges');const hdr=document.getElementById('hdr');
const coachToggle=document.getElementById('coachToggle');const coachPanel=document.getElementById('coachPanel');const coachList=document.getElementById('coachList');

for(let w=1; w<=WEEKS; w++){ const o=document.createElement('option'); o.value=w; o.textContent="Week "+w; weekSel.appendChild(o); }

function refreshPlayers(){ playerSel.innerHTML=''; loadPlayers().forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; playerSel.appendChild(o); }); }
refreshPlayers(); playerSel.value = loadPlayers()[0];

addPlayerBtn.onclick=()=>{ const n=prompt("Player name"); if(!n) return; const list=loadPlayers(); if(!list.includes(n)){ list.push(n); savePlayers(list); refreshPlayers(); playerSel.value=n; render(); } };
playerSel.onchange=render; daySel.onchange=render; weekSel.onchange=()=>{ render(); updatePhaseLabel(); };

settingsBtn.onclick=()=>{ settings.classList.toggle('hidden'); const p=playerSel.value; const set=loadSettings(p); document.getElementById('sPlayerName').value=p; sSchool.value=set.school||""; sMascot.value=set.mascot||""; sColors.value=set.colors||""; sCoachUrl.value=set.coachUrl||""; };
saveBtn.onclick=()=>{ const old=playerSel.value; const newName=document.getElementById('sPlayerName').value.trim()||old; if(newName!==old){ const list=loadPlayers().filter(n=>n!==old); list.push(newName); savePlayers(list); refreshPlayers(); playerSel.value=newName; }
  saveSettings(newName, {school:sSchool.value.trim(), mascot:sMascot.value.trim(), colors:sColors.value.trim(), coachUrl:sCoachUrl.value.trim()}); settings.classList.add('hidden'); render(); };

function init(day){ return {warmup: PROGRAM[day].warmup.map(()=>false),strength: PROGRAM[day].strength.map(b=>({weight:"",notes:"",sets:Array.from({length:b.sets},()=>({done:false}))})),core: PROGRAM[day].core.map(()=>false),jump: PROGRAM[day].jump.map(()=>false),notes:""}; }

function updateXPView(p){ const x=getXP(p); xpEl.textContent="XP "+x; const pct=Math.min(100,(x%100)); xpbar.style.width=pct+"%"; badges.innerHTML=""; [["Bronze",100],["Silver",300],["Gold",600]].forEach(([n,t])=>{ const b=document.createElement('span'); b.className='badge'; b.textContent=n+(x>=t?" ✓":""); badges.appendChild(b); }); }
function awardXPOnce(p,id,amt){ const m=loadEarned(p); if(m[id]) return; m[id]=amt; saveEarned(p,m); setXP(p,getXP(p)+amt); updateXPView(p); }
function updateStreak(p){ const today=new Date().toDateString(); const last=getLast(p); let s=getStreak(p); if(last!==today){ const y=new Date(Date.now()-86400000).toDateString(); s=(last===y)?s+1:1; setStreak(p,s); setLast(p,today); } streakEl.textContent="Streak "+getStreak(p); }

function openTrainer(name){ const d=EX[name]; if(!d) return; mTitle.textContent=name;
 function fill(a,id){ const el=document.getElementById(id); el.innerHTML=""; (a||[]).forEach(x=>{ const li=document.createElement('li'); li.textContent=x; el.appendChild(li); }); }
 fill(d.setup,'mSetup'); fill(d.exec,'mExec'); fill(d.focus,'mFocus'); fill(d.mistakes,'mMistakes'); fill(d.why,'mWhy'); document.getElementById('trainerModal').style.display='flex'; }
document.getElementById('mClose').onclick=()=>document.getElementById('trainerModal').style.display='none';
document.getElementById('trainerModal').onclick=(e)=>{ if(e.target.id==='trainerModal') document.getElementById('trainerModal').style.display='none'; };

exportBtn.onclick=()=>{ const p=playerSel.value,d=+daySel.value,w=+weekSel.value; const e=loadEntry(p,d,w)||init(d); const rows=[["Player","Week","Day","Section","Item","Set","Done","Weight","Notes","XP","Streak","School","Mascot","Colors"]]; const set=loadSettings(p);
e.warmup.forEach((ck,i)=>rows.push([p,w,d,"Warmup",PROGRAM[d].warmup[i],"",ck?"yes":"","","",getXP(p),getStreak(p),set.school||"",set.mascot||"",set.colors||""]));
e.strength.forEach((blk,i)=>{ const ex=PROGRAM[d].strength[i].ex; blk.sets.forEach((st,si)=>rows.push([p,w,d,"Strength",ex,si+1,st.done?"yes":"",blk.weight||"",blk.notes||"",getXP(p),getStreak(p),set.school||"",set.mascot||"",set.colors||""])); });
e.core.forEach((ck,i)=>rows.push([p,w,d,"Core",PROGRAM[d].core[i],"",ck?"yes":"","","",getXP(p),getStreak(p),set.school||"",set.mascot||"",set.colors||""]));
e.jump.forEach((ck,i)=>rows.push([p,w,d,"Jump",PROGRAM[d].jump[i],"",ck?"yes":"","","",getXP(p),getStreak(p),set.school||"",set.mascot||"",set.colors||""]));
const csv=rows.map(r=>r.map(x=>`"${(x??"").toString().replace(/"/g,'""')}"`).join(",")).join("\n"); const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"})); a.download=`OSC_${p}_w${w}_d${d}.csv`; a.click(); };

sendCoach.onclick=async()=>{ const p=playerSel.value,d=+daySel.value,w=+weekSel.value; const set=loadSettings(p); if(!set.coachUrl){ alert("Set Coach Sync URL in Settings first."); return; } const payload={player:p,week:w,day:d,xp:getXP(p),streak:getStreak(p),notes:notes.value,entry:loadEntry(p,d,w)||init(d),settings:set,ts:new Date().toISOString()}; try{ const res=await fetch(set.coachUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)}); alert(res.ok?"Sent to Coach.":"Coach URL error."); }catch(e){ alert("Could not send. Check URL or connection."); } };

coachToggle.onchange=()=>{ if(coachToggle.checked) coachPanel.classList.remove('hidden'); else coachPanel.classList.add('hidden'); renderCoach(); };

function renderCoach(){ if(!coachToggle.checked) return; const list=loadPlayers(); let html="<table style='width:100%;border-collapse:collapse'>"; html+="<tr><th align='left'>Player</th><th align='left'>Week</th><th align='left'>Day</th><th align='left'>Completed</th><th align='left'>XP</th><th align='left'>Streak</th></tr>"; list.forEach(p=>{ let done=0,total=0; const d=+daySel.value, w=+weekSel.value||1; const data=loadEntry(p,d,w)||init(d); total+=PROGRAM[d].warmup.length + PROGRAM[d].core.length + PROGRAM[d].jump.length; data.warmup.forEach(x=>{if(x)done++;}); data.core.forEach(x=>{if(x)done++;}); data.jump.forEach(x=>{if(x)done++;}); PROGRAM[d].strength.forEach((blk,i)=>{ total+=blk.sets; data.strength[i].sets.forEach(s=>{if(s.done)done++;}); }); html+=`<tr><td>${p}</td><td>${w}</td><td>${d}</td><td>${done} / ${total}</td><td>${getXP(p)}</td><td>${getStreak(p)}</td></tr>`; }); html+="</table>"; coachList.innerHTML=html; }

function totalBoxes(d){ let t=0; t+=PROGRAM[d].warmup.length + PROGRAM[d].core.length + PROGRAM[d].jump.length; PROGRAM[d].strength.forEach(blk=>t+=blk.sets); return t; }
function currentDone(data,d){ let c=0; data.warmup.forEach(x=>{if(x)c++;}); data.core.forEach(x=>{if(x)c++;}); data.jump.forEach(x=>{if(x)c++;}); PROGRAM[d].strength.forEach((blk,i)=>data.strength[i].sets.forEach(s=>{if(s.done)c++;})); return c; }

function render(){ updatePhaseLabel(); const p=playerSel.value,d=+daySel.value,w=+weekSel.value||1; if(!weekSel.value) weekSel.value=1; const set=loadSettings(p);
  document.getElementById('schoolTag').textContent=(set.school||"School")+" "+(set.mascot||"Mascot")+" | "+(set.colors||"");
  const data=loadEntry(p,d,w)||init(d); updateXPView(p); document.getElementById('streak').textContent="Streak "+getStreak(p);
  document.getElementById('why').innerHTML=PROGRAM[d].why.map(t=>"<div class='muted'>• "+t+"</div>").join("");
  const total=totalBoxes(d); const done=currentDone(data,d); document.getElementById('xpbar').style.width=(100*done/total)+"%";
  const content=document.getElementById('content'); content.innerHTML="";
  // Warmup
  const warm=document.createElement('div'); warm.className="card"; warm.innerHTML="<strong>Warm-Up</strong>";
  PROGRAM[d].warmup.forEach((it,idx)=>{ const row=document.createElement('div'); row.className="row"; const id=`wu_${d}_${idx}`; const cb=document.createElement('input'); cb.type="checkbox"; cb.checked=data.warmup[idx]; cb.onchange=()=>{ data.warmup[idx]=cb.checked; saveEntry(p,d,w,data); if(cb.checked){ awardXPOnce(p,id,5); updateStreak(p); } document.getElementById('xpbar').style.width=(100*currentDone(data,d)/total)+"%"; renderCoach(); }; const link=document.createElement('span'); link.className="exercise-link"; link.textContent=" "+it; link.onclick=()=>{ const base=it.split(' — ')[0].split(' × ')[0]; openTrainer(base); }; row.appendChild(cb); row.appendChild(link); warm.appendChild(row); });
  content.appendChild(warm);
  // Strength
  const str=document.createElement('div'); str.className="card"; str.innerHTML="<strong>Strength</strong><div class='grid gridHeader'><div>Exercise</div><div>Sets</div><div>Reps</div><div>Weight / Notes</div></div>";
  PROGRAM[d].strength.forEach((blk,bi)=>{ const g=document.createElement('div'); g.className="grid"; const link=document.createElement('span'); link.className="exercise-link"; link.textContent=blk.ex; link.onclick=()=>{ const base=blk.ex.split(' — ')[0].split(' × ')[0]; openTrainer(base); };
    const c1=document.createElement('div'); c1.appendChild(link); g.appendChild(c1);
    const c2=document.createElement('div'); c2.textContent=blk.sets; g.appendChild(c2);
    const c3=document.createElement('div'); c3.textContent=blk.reps; g.appendChild(c3);
    const c4=document.createElement('div');
    const tarea=document.createElement('textarea'); tarea.className="note"; tarea.placeholder="Notes"; tarea.value=(data.strength[bi].notes||"");
    if(blk.weighted===true){ const winput=document.createElement('input'); winput.placeholder='lb'; winput.style.width='100%'; winput.value=(data.strength[bi].weight||''); winput.oninput=()=>{ data.strength[bi].weight=winput.value; saveEntry(p,d,w,data); }; c4.appendChild(winput); }
    tarea.oninput=()=>{ data.strength[bi].notes=tarea.value; saveEntry(p,d,w,data); }; c4.appendChild(tarea); g.appendChild(c4); str.appendChild(g);
    const setRow=document.createElement('div'); setRow.className="row"; setRow.style.marginTop="6px";
    for(let s=0;s<blk.sets;s++){ const lb=document.createElement('label'); lb.className="row"; const cb=document.createElement('input'); cb.type="checkbox"; cb.checked=data.strength[bi].sets[s].done; const id=`st_${d}_${bi}_${s}`; cb.onchange=()=>{ data.strength[bi].sets[s].done=cb.checked; saveEntry(p,d,w,data); if(cb.checked) awardXPOnce(p,id,10); updateStreak(p); document.getElementById('xpbar').style.width=(100*currentDone(data,d)/total)+"%"; renderCoach(); }; lb.appendChild(cb); lb.append(" Set "+(s+1)); setRow.appendChild(lb); } str.appendChild(setRow); });
  content.appendChild(str);
  // Core
  const core=document.createElement('div'); core.className="card"; core.innerHTML="<strong>Core</strong>";
  PROGRAM[d].core.forEach((it,idx)=>{ const row=document.createElement('div'); row.className="row"; const id=`co_${d}_${idx}`; const cb=document.createElement('input'); cb.type="checkbox"; cb.checked=data.core[idx]; cb.onchange=()=>{ data.core[idx]=cb.checked; saveEntry(p,d,w,data); if(cb.checked) awardXPOnce(p,id,5); updateStreak(p); document.getElementById('xpbar').style.width=(100*currentDone(data,d)/total)+"%"; renderCoach(); }; const link=document.createElement('span'); link.className="exercise-link"; link.textContent=" "+it; link.onclick=()=>{ const base=it.split(' — ')[0].split(' × ')[0]; openTrainer(base); }; row.appendChild(cb); row.appendChild(link); core.appendChild(row); });
  content.appendChild(core);
  // Jump
  const jump=document.createElement('div'); jump.className="card"; jump.innerHTML="<strong>Jump Mechanics</strong>";
  PROGRAM[d].jump.forEach((it,idx)=>{ const row=document.createElement('div'); row.className="row"; const id=`jm_${d}_${idx}`; const cb=document.createElement('input'); cb.type="checkbox"; cb.checked=data.jump[idx]; cb.onchange=()=>{ data.jump[idx]=cb.checked; saveEntry(p,d,w,data); if(cb.checked) awardXPOnce(p,id,8); updateStreak(p); document.getElementById('xpbar').style.width=(100*currentDone(data,d)/total)+"%"; renderCoach(); }; const link=document.createElement('span'); link.className="exercise-link"; link.textContent=" "+it; link.onclick=()=>{ const base=it.split(' — ')[0].split(' × ')[0]; openTrainer(base); }; row.appendChild(cb); row.appendChild(link); jump.appendChild(row); });
  content.appendChild(jump);
  // Notes
  notes.value=(data.notes||""); notes.oninput=()=>{ data.notes=notes.value; saveEntry(p,d,w,data); };
  renderCoach();
}

for(let w=1; w<=WEEKS; w++){ const o=document.createElement('option'); o.value=w; o.textContent="Week "+w; weekSel.appendChild(o); }
function firstRun(){
  refreshPlayers(); playerSel.value = loadPlayers()[0]; if(!weekSel.value) weekSel.value=1; render();
}
firstRun(); updatePhaseLabel();

// --- Role, PIN, and player binding ---
const roleKey='osc_role'; const pinKey='osc_pin'; const boundPlayerKey='osc_bound_player';

function currentRole(){ return localStorage.getItem(roleKey)||'player'; }
function setRole(r){ localStorage.setItem(roleKey,r); document.body.classList.toggle('coach', r==='coach'); }

function currentPlayer(){
  if(currentRole()==='player'){
    const b=localStorage.getItem(boundPlayerKey);
    if(b) return b;
    const list=loadPlayers(); return list[0]||'Player';
  }
  return playerSel.value;
}
function setCurrentPlayer(n){
  if(currentRole()==='player'){
    localStorage.setItem(boundPlayerKey,n);
  }else{
    playerSel.value=n;
  }
  refreshPlayers();
}

function promptForNameOnce(){
  if(localStorage.getItem(boundPlayerKey)) return;
  const nm=(prompt("Enter your name")||"").trim();
  if(!nm){ alert("Name is required to continue."); return promptForNameOnce(); }
  const list=loadPlayers(); if(!list.includes(nm)){ list.push(nm); savePlayers(list); }
  localStorage.setItem(boundPlayerKey, nm);
}

function openSettings(){
  settings.classList.remove('hidden');
  const p=currentPlayer(); const set=loadSettings(p);
  sPlayerName.value=p||''; sPlayerName.disabled = (currentRole()==='player');
  sSchool.value=set.school||''; sMascot.value=set.mascot||''; sColors.value=set.colors||''; sCoachUrl.value=set.coachUrl||'';
}

function switchToCoach(){
  let savedPIN=localStorage.getItem(pinKey)||'';
  if(!savedPIN){
    const create=prompt("Create a new Coach PIN"); if(!create){ alert("PIN not set."); return; }
    savedPIN=create.trim(); localStorage.setItem(pinKey, savedPIN);
  }
  const entered=prompt("Enter Coach PIN"); if(entered!==savedPIN){ alert("Incorrect PIN."); return; }
  setRole('coach'); coachToggle.checked=true; coachPanel.classList.remove('hidden'); renderCoach();
}

// Wire header buttons
document.getElementById('coachModeBtn').onclick = switchToCoach;
document.getElementById('settingsBtn').onclick = openSettings;

// Save button hardens coach-only rename/pin update
saveBtn.onclick=()=>{
  const role=currentRole(); const old=currentPlayer(); const newName=(role==='coach')?(sPlayerName.value.trim()||old):old;
  if(role==='coach' && newName!==old){ const list=loadPlayers().filter(n=>n!==old); if(!list.includes(newName)) list.push(newName); savePlayers(list); refreshPlayers(); setCurrentPlayer(newName); }
  saveSettings(newName, {school:sSchool.value.trim(), mascot:sMascot.value.trim(), colors:sColors.value.trim(), coachUrl:sCoachUrl.value.trim()});
  settings.classList.add('hidden'); render();
};

// Hide player selector in Player mode
document.body.classList.toggle('coach', currentRole()==='coach');

// First-run name prompt before first render
promptForNameOnce();

// --- Coach-only Reset App ---
async function hardResetApp(){
  try{
    localStorage.clear();
    if('serviceWorker' in navigator){
      try{ const regs=await navigator.serviceWorker.getRegistrations(); for(const r of regs){ await r.unregister(); } }catch(e){}
    }
    if('caches' in window){
      try{ const names=await caches.keys(); await Promise.all(names.map(n=>caches.delete(n))); }catch(e){}
    }
    location.reload(true);
  }catch(e){ alert('Reset failed. Close and reopen the app.'); }
}
(function(){
  const btn=document.getElementById('resetAppBtn');
  if(btn){
    btn.onclick=()=>{
      if(currentRole()!=='coach'){ alert('Reset is coach-only.'); return; }
      if(confirm('Reset the entire app on this device? This erases ALL players, data, and PINs.')){ hardResetApp(); }
    };
  }
})();


function updatePhaseLabel(){
  const w = +weekSel.value || 1;
  const txt = (w<=6) ? 'Phase 1' : 'Phase 2';
  const ph = document.getElementById('phaseLabel');
  if(ph) ph.textContent = txt;
}


// --- Definitive week dropdown normalizer (enforces exactly 1..12 once) ---
(function normalizeWeeks(){
  try{
    if(!window.__oscWeekNormalized){
      weekSel.innerHTML='';
      for(let w=1; w<=12; w++){
        const o=document.createElement('option');
        o.value = w;
        o.textContent = 'Week ' + w;
        weekSel.appendChild(o);
      }
      if(!weekSel.value) weekSel.value = 1;
      window.__oscWeekNormalized = true;
    }
  }catch(e){}
})();

</script>
<button id="fabSettings" class="fab" onclick="openSettings()">Settings</button>

<script>
// Gentle one-time name prompt AFTER initial render
(function(){
  const BOUND_KEY = 'osc_bound_player';
  function bound(){ try{return localStorage.getItem(BOUND_KEY)||null;}catch(e){return null;} }
  function bind(n){ try{localStorage.setItem(BOUND_KEY,n);}catch(e){} }
  // Run shortly after first paint so workouts are visible even if prompt is dismissed
  setTimeout(function(){
    var bp = bound();
    if(!bp){
      var nm = (prompt("Enter your name")||"").trim();
      if(nm){
        // ensure in players list
        try{
          var list = JSON.parse(localStorage.getItem("osc_players")||"[]");
          if(list.indexOf(nm)===-1){ list.push(nm); localStorage.setItem("osc_players", JSON.stringify(list)); }
          bind(nm);
          // point selector and re-render
          var sel = document.getElementById('player');
          if(sel){ sel.value = nm; }
          if(typeof render==="function") render();
        }catch(e){}
      }
    }
  }, 300);
})();
</script>

</body></html>
