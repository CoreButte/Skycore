<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0c204a">
<title>Operation Sky Core — Player (v3.4.0)</title>
<style>
:root{--bg:#0c204a;--panel:#163678;--text:#e7eef9;--muted:#a0b8d6;--border:#263a64;--accent:#2d6edc}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
h1{font-size:18px;margin:0}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
input,select,button,textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 12px;font-size:14px}
button{cursor:pointer}
.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px;margin:12px 0}
.progress{height:10px;background:#0b1a3a;border-radius:999px;border:1px solid var(--border);overflow:hidden;flex:1}
.progress>div{height:100%;background:var(--accent);width:0%}
.small{font-size:12px;color:var(--muted)}
.exercise-link{text-decoration:underline;cursor:pointer}
.hidden{display:none}
.badges{display:flex;gap:6px}
.badge{border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
.modal .box{background:#0e1f4a;border:1px solid var(--border);max-width:720px;width:100%;border-radius:14px;overflow:hidden}
.modal header{padding:12px 16px;border-bottom:1px solid var(--border)}
.modal .content{padding:16px}
.modal h3{margin:0;font-size:18px}
.modal ul{margin:.25rem 0 .75rem 1.25rem}
.modal .close{margin-left:auto}
</style>
</head>
<body>
<div class="wrap">
  <header class="row">
    <h1>Operation Sky Core — <span id="phaseLabel">Phase 1</span> <span class="small">(Player v3.4.0)</span></h1>
    <div class="row">
      <select id="player"></select>
      <select id="daySel">
        <option value="1">Day 1</option>
        <option value="2">Day 2</option>
        <option value="3">Day 3</option>
      </select>
      <select id="week"></select>
    </div>
  </header>

  <div class="row" id="hdr">
    <span class="chip" id="playerTag"></span>
    <span class="chip" id="xp">XP 0</span>
    <span class="chip" id="streak">Streak 0</span>
    <div class="badges" id="badges"></div>
  </div>

  <div class="card">
    <strong>Progress</strong>
    <div class="progress"><div id="xpbar"></div></div>
    <div class="small">Bronze 100 | Silver 300 | Gold 600</div>
  </div>

  <div class="card"><strong>Why today matters</strong><div id="why"></div></div>

  <div id="content"></div>

  <div class="card"><strong>Notes</strong><textarea id="notes" class="note" placeholder="Notes for today..."></textarea></div>
</div>

<div class="modal" id="trainerModal">
  <div class="box">
    <header class="row"><h3 id="mTitle">Exercise</h3><button class="close" id="mClose">Close</button></header>
    <div class="content">
      <div class="muted">Setup</div><ul id="mSetup"></ul>
      <div class="muted">Execution</div><ul id="mExec"></ul>
      <div class="muted">Focus cues</div><ul id="mFocus"></ul>
      <div class="muted">Common mistakes</div><ul id="mMistakes"></ul>
      <div class="muted">Why this increases vertical</div><ul id="mWhy"></ul>
    </div>
  </div>
</div>

<script>
// register service worker
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(()=>{});}

const WEEKS=12;
const listKey="osc_players";
const key=(p,d,w)=>`osc_p${p}_d${d}_w${w}`;
const xpKey=(p)=>`osc_xp_${p}`;
const streakKey=(p)=>`osc_streak_${p}`;
const lastKey=(p)=>`osc_last_${p}`;
const earnedKey=(p)=>`osc_earned_${p}`;

function loadPlayers(){const raw=localStorage.getItem(listKey);return raw?JSON.parse(raw):[];}
function savePlayers(v){localStorage.setItem(listKey, JSON.stringify(v));}
function getXP(p){return +(localStorage.getItem(xpKey(p))||0);}
function setXP(p,v){localStorage.setItem(xpKey(p),v);}
function getStreak(p){return +(localStorage.getItem(streakKey(p))||0);}
function setStreak(p,v){localStorage.setItem(streakKey(p),v);}
function getLast(p){return localStorage.getItem(lastKey(p));}
function setLast(p,day){localStorage.setItem(lastKey(p),day);}
function loadEarned(p){return JSON.parse(localStorage.getItem(earnedKey(p))||'{}');}
function saveEarned(p,m){localStorage.setItem(earnedKey(p),JSON.stringify(m));}

// prompt for player name if not set
function promptForNameOnce(){
  const existing=loadPlayers();
  if(existing.length>0)return existing[0];
  let nm="";
  while(!nm){
    nm=(prompt("Enter your name:")||"").trim();
  }
  savePlayers([nm]);
  return nm;
}

const playerSel=document.getElementById('player');
const weekSel=document.getElementById('week');
const daySel=document.getElementById('daySel');
const xpEl=document.getElementById('xp');
const streakEl=document.getElementById('streak');
const xpbar=document.getElementById('xpbar');
const badges=document.getElementById('badges');
const playerTag=document.getElementById('playerTag');

// populate weeks
for(let w=1;w<=WEEKS;w++){
  const o=document.createElement('option');
  o.value=w;
  o.textContent="Week "+w;
  weekSel.appendChild(o);
}
weekSel.value=1;

function refreshPlayer(){
  const list=loadPlayers();
  playerSel.innerHTML='';
  list.forEach(n=>{
    const o=document.createElement('option');
    o.value=n;
    o.textContent=n;
    playerSel.appendChild(o);
  });
  playerSel.value=list[0]||'';
  playerTag.textContent=list[0]||'';
}

function updateXPView(p){
  const x=getXP(p);
  xpEl.textContent="XP "+x;
  const pct=Math.min(100,(x%100));
  xpbar.style.width=pct+"%";
  badges.innerHTML="";
  [["Bronze",100],["Silver",300],["Gold",600]].forEach(([n,t])=>{
    const b=document.createElement('span');
    b.className='badge';
    b.textContent=n+(x>=t?" ✓":"");
    badges.appendChild(b);
  });
}
function updateStreak(p){
  const today=new Date().toDateString();
  const last=getLast(p);
  let s=getStreak(p);
  if(last!==today){
    const y=new Date(Date.now()-86400000).toDateString();
    s=(last===y)?s+1:1;
    setStreak(p,s);
    setLast(p,today);
  }
  streakEl.textContent="Streak "+getStreak(p);
}

const playerName=promptForNameOnce();
refreshPlayer();
updateXPView(playerName);
updateStreak(playerName);

// placeholder workouts
document.getElementById('why').innerHTML="Stay consistent. Quality reps now build long-term power.";
document.getElementById('content').innerHTML="<div class='card'><strong>Warm-Up</strong><br>All your daily warm-ups appear here.<br><br><em>Coach cards and XP tracking remain functional.</em></div>";

</script>
</body>
</html>
